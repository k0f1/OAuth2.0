<!--Updated Google Sign-In-->
<!DOCTYPE html>
<html>
<head>
  <!-- BEGIN Pre-requisites -->


  <!--  Step 1: Include the below script in the head tag-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer></script>

  <!-- END Pre-requisites -->


  <script>
    function start() {
      gapi.load('auth2', function() {
        auth2 = gapi.auth2.init({
          client_id: '377693933630-mt7bk2ot1bp6j06773v3n295h12bevpk.apps.googleusercontent.com'
        });
      });
    }
  </script>
</head>

<body>

  <!--  Step 2: In the <body> tag, add the below button and div -->
  <button id="signinButton">Sign in with Google</button>
  <div id="result"></div>
  <!--  Step 3: Add the below script before the ending </body> tag -->
  <script>
    $('#signinButton').click(function() {
      function signInCallback(authResult){
        if (authResult['code']){
          // If the object authResult contains a parameter called code,
          // Then we know that our one time code is present

          //Hide the sign-in button now that the user is authorized
          $('#signinButton').attr('style', 'display: none');
          $.ajax({
            type: 'POST',
            url: '/gconnect?state={{STATE}}',
            // Always include an `X-Requested-With` header in every AJAX request,
            // to protect against CSRF attacks.
            headers: {
            'X-Requested-With': 'XMLHttpRequest'
            },
            contentType: 'application/octet-stream; charset=utf-8',
            success:function(result){
              $('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
                   setTimeout(function() {
                    window.location.href = "/";
                   }, 2000);
            },
            processData:false,
            data:authResult['code']
          });
        } else{
          // handle error
          console.log('There was an error: ' + authResult['error']);
          $('#result').html('Failed to make a server-side call. Check your configuration and console.');
        }
      }
      auth2.grantOfflineAccess().then(signInCallback);
    });
  </script>
</body>




</html>
